name: GlobalStockNow AI Pipeline

on:
  # 1. 수동 실행: 보스께서 언제든 GitHub에서 [Run workflow]를 누르실 수 있습니다.
  workflow_dispatch: 

  # 2. 자동 실행: 매시간 정각에 글로벌 뉴스를 수집하도록 설정되었습니다.
  schedule:
    - cron: '0 * * * *'

jobs:
  analyze_and_report:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v3

    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests feedparser

    - name: Run AI Analyzer (Ver 1.7.0)
      env:
        # 보스의 금고(Secrets)에서 열쇠를 가져와 주입합니다.
        GROQ_API_KEY: ${{ secrets.GROQ_API_KEY }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      run: |
        # 먼저 뉴스를 수집한 후 (필요시 fetch_news.py 실행)
        # 보정된 5점 필터 및 HTML 생성 로직이 담긴 analyzer.py를 실행합니다.
        python analyzer.py
