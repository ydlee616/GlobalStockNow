name: GlobalStockNow AI Pipeline

on:
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ ë²„íŠ¼
  schedule:
    - cron: '0 22 * * *'  # ë§¤ì¼ ë°¤ 10ì‹œ (UTC ê¸°ì¤€, í•œêµ­ ì˜¤ì „ 7ì‹œ)

jobs:
  run-pipeline:
    runs-on: ubuntu-latest
    
    steps:
    # 1. ì½”ë“œ ê°€ì ¸ì˜¤ê¸°
    - name: Checkout repository
      uses: actions/checkout@v4

    # 2. íŒŒì´ì¬ ì„¤ì¹˜
    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'

    # 3. ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜ (requirements.txt ì‚¬ìš©)
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 4. ë‰´ìŠ¤ ìˆ˜ì§‘ ì‹¤í–‰ (collector.py)
    - name: Run News Collector
      run: python collector.py

    # 5. AI ë¶„ì„ ì‹¤í–‰ (analyzer.py) - ì—¬ê¸°ê°€ ê°€ì¥ ì¤‘ìš”í•©ë‹ˆë‹¤!
    - name: Run AI Analyzer
      env:
        GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
        TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
        TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
      # ğŸ”¥ ë°˜ë“œì‹œ ìš°ë¦¬ê°€ ìˆ˜ì •í•œ íŒŒì¼ëª…(analyzer.py)ê³¼ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤.
      run: python analyzer.py

    # 6. ê²°ê³¼ íŒŒì¼ ì—…ë¡œë“œ (ë””ë²„ê¹…ìš©)
    - name: Upload Raw Data
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: raw-news-data-${{ github.run_number }}
        path: breaking_news.json

    - name: Upload Analysis Report
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: ai-analysis-report-${{ github.run_number }}
        path: analyzed_news.json
